{{ define "main" }}
  <h1 class="text-3xl font-bold mb-6">{{ i18n "bookListTitle" }}</h1>
{{ partial "page-header" . }}

<p><strong>{{ i18n "tagsLabel" }}:</strong>
  {{ $allTags := slice }}
  {{ range .Pages }}
    {{ range .Params.tags }}
      {{ $allTags = $allTags | append . }}
    {{ end }}
  {{ end }}
  {{ $uniqueTags := uniq $allTags | sort }}
  <nav class="filters mb-8">
    {{ range $uniqueTags }}
      <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}"
         class="inline-block px-3 py-1 mr-2 mb-2 bg-gray-200 rounded-full text-sm hover:bg-gray-300">
        {{ . }}
      </a>
    {{ end }}
  </nav>
  
<p><strong>{{ i18n "authorLabel" }}:</strong>
  {{/* 1) Alle Autoren sammeln */}}
  {{ $allAuthors := slice }}
  {{ range .Pages }}
    {{ $ap := .Params.authors }}
    {{ if $ap }}
      {{ if eq (printf "%T" $ap) "string" }}
        {{/* Einzel-Author */}}
        {{ $allAuthors = $allAuthors | append $ap }}
      {{ else }}
        {{/* Liste von Autoren */}}
        {{ range $ap }}
          {{ $allAuthors = $allAuthors | append . }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{/* 2) Einzigartige Autoren sortieren */}}
  {{ $uniqueAuthors := uniq $allAuthors | sort }}

  {{/* 3) Als Links rendern */}}
  <nav class="filters mb-8">
    {{ range $uniqueAuthors }}
      <a href="{{ "/authors/" | relLangURL }}{{ . | urlize }}"
         class="inline-block px-3 py-1 mr-2 mb-2 bg-gray-200 rounded-full text-sm hover:bg-gray-300">
        {{ . }}
      </a>
    {{ end }}
  </nav>
</p>

<p>&nbsp;</p>

  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {{ $size := .Site.Params.book.imageSizeList }}
    {{ $dash := cond (gt (len $size) 0) (printf "-%s" $size) "" }}
    {{ range .Pages.ByDate.Reverse }}
      <article class="book-card border rounded-lg overflow-hidden shadow hover:shadow-lg transition-shadow duration-200">
        <a href="{{ .Permalink }}">
          {{/* override_cover prüfen */}}
          {{ with .Params.override_cover }}
            <img
              src="{{ . }}"
              alt="{{ $.Title }} Cover"
              class="w-full h-48 object-cover">
          {{ else }}
            <img
              src="https://covers.openlibrary.org/b/isbn/{{ .Params.isbn }}{{ $dash }}.jpg?default=false"
              alt="{{ .Title }} Cover"
              class="w-full h-48 object-cover"
              onerror="this.style.display='none'">
          {{ end }}

          <div class="p-4">
            <h2 class="text-lg font-semibold mb-1">{{ .Title }}</h2>
            <p class="text-sm text-gray-600">
              {{ with .Params.override_author }}{{ . }}{{ else }}{{ index .Params.authors 0 }}{{ end }}
            </p>
            
            <p><strong>{{ i18n "ratingLabel" }}:</strong>
      		{{ $r := .Params.rating }}
      		{{ range $i := seq 5 }}
        		{{ if ge $r $i }}
          			<span class="text-yellow-500 text-xl">★</span>
        		{{ else }}
          			<span class="text-gray-300 text-xl">★</span>
        		{{ end }}
      		{{ end }}
    	  </p>
          </div>
          
        </a>
      </article>
    {{ end }}
  </div>
{{ end }}
